(function(v,r,w,t,F,$,I,_,x){"use strict";var R=r.findByProps("canUseAnimatedEmojis"),L="canUseStickersEverywhere",E="canUseCustomStickersEverywhere",U=R[E]?E:L,M=()=>w.instead(U,R,()=>!0);function C(e,n,a,s,c,l,d){try{var o=e[l](d),i=o.value}catch(S){a(S);return}o.done?n(i):Promise.resolve(i).then(s,c)}function G(e){return function(){var n=this,a=arguments;return new Promise(function(s,c){var l=e.apply(n,a);function d(i){C(l,s,c,d,o,"next",i)}function o(i){C(l,s,c,d,o,"throw",i)}d(void 0)})}}var{getChannel:V}=r.findByStoreName("ChannelStore"),O="https://media.discordapp.net/stickers/{stickerId}.{format}?size={size}";function D(e,n){if(!e.guild_id)return!0;var a=V(n).guild_id;return e.guild_id==a}function H(e){var n=e.format_type===4?"gif":"png";return O.replace("{stickerId}",e.id).replace("{format}",n).replace("{size}",t.storage.stickerSize.toString())}function j(e){return p.apply(this,arguments)}function p(){return p=G(function*(e){try{var n=e.replace(".png",".gif");return n}catch(a){return $.logger.error(`Failed to convert ${e} to GIF: `,a),null}}),p.apply(this,arguments)}var K=18e5,h=new Map;function q(e,n){h.set(e,n),setTimeout(()=>h.delete(e),K)}function J(e){return h.get(e)}var{openAlert:Q}=r.findByProps("openAlert","dismissAlert"),{AlertModal:T,AlertActionButton:k}=r.findByProps("AlertModal","AlertActions"),{Stack:W,TextInput:ve}=r.findByProps("Stack");function N(e){T&&k?X(e):I.showConfirmationAlert(e)}function X({title:e,content:n,placeholder:a,confirmText:s,cancelText:c,onConfirm:l}){Q(Y(e),React.createElement(T,{title:e,content:n,actions:React.createElement(W,null,React.createElement(k,{text:s,variant:"primary",onPress:l}),c?React.createElement(k,{text:c,variant:"secondary"}):React.createElement(React.Fragment,null))}))}function Y(e){return`vdarnfg-${e?.toLowerCase?.().replaceAll?.(" ","-")}`}function Z(e){N({title:"APNG Sticker",content:`This sticker will be converted to a GIF using Ezgif and an Ezgif link will be sent in chat.
Do you want to continue?`,confirmText:"Continue",cancelText:"Cancel",onConfirm:e})}function ee(e){N({title:"APNG conversion failed",content:[(e?"Instead of an animated GIF, raw APNG sticker will be sent in chat":"No stickers will be sent in chat")+", you can customize this behavior in plugin settings.","","Check debug logs for more information about the error."].join(`
`),confirmText:"OK"})}var P=r.findByProps("sendMessage","receiveMessage"),{getStickerById:te}=r.findByStoreName("StickersStore"),{getCurrentUser:ne}=r.findByStoreName("UserStore"),ae=()=>w.instead("sendStickers",P,(e,n)=>{if(!t.storage.ignoreNitro&&ne?.().premiumType!==null)return n(...e);var[a,s,c,l]=e,d=s.map(g=>te(g)),o=d.filter(g=>!D(g,a));if(!o.length)return n(...e);var i=function(){var g=G(function*(fe=!1){fe&&(t.storage.ackedApng=!0);for(var m of o){var u=H(m);if(m.format_type===2&&t.storage.convertApng){var A=J(u);if(!A){F.showToast("Converting APNG sticker to GIF..");var b=yield j(u);if(b)q(u,b);else if(ee(t.storage.staticApngOnFail),!t.storage.staticApngOnFail)continue;A=b}u=A??u}t.storage.hyperlink&&m.name&&(u=`[${m.name}](${u})`),P.sendMessage(a,{content:u},null,l)}});return function(){return g.apply(this,arguments)}}(),S=o.find(g=>g.format_type==2)&&!t.storage.ackedApng;S?Z(()=>i(!0)):i()}),{Stack:re,TableRadioGroup:oe,TableRadioRow:ie,TableSwitchRow:f,TableRowGroup:z}=r.findByProps("TableRow","TableRowGroup"),{ScrollView:se}=x.General,ce=r.findByName("HelpMessage"),le=[16,32,64,128,160,256,512,1024];t.storage.convertApng??=!0,t.storage.hyperlink??=!0,t.storage.stickerSize??=160;function ue(){return _.useProxy(t.storage),React.createElement(se,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(re,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(z,{title:"General"},React.createElement(f,{label:"Hyperlink stickers",value:t.storage.hyperlink,onValueChange:e=>t.storage.hyperlink=e}),React.createElement(f,{label:"Ignore Nitro",subLabel:"Force FreeStickers even when you have Nitro",value:t.storage.ignoreNitro,onValueChange:e=>t.storage.ignoreNitro=e})),React.createElement(z,{title:"APNG Stickers"},React.createElement(f,{label:"Convert APNG stickers to GIF",subLabel:"This is needed for stickers to be animated (uses Ezgif).",value:t.storage.convertApng,onValueChange:e=>t.storage.convertApng=e}),React.createElement(f,{label:"Send static sticker if APNG conversion fails",value:t.storage.staticApngOnFail,onValueChange:e=>t.storage.staticApngOnFail=e}),React.createElement(f,{label:"Show warning dialog for APNG stickers",subLabel:"This will only appear once",value:!t.storage.ackedApng,onValueChange:e=>t.storage.ackedApng=!e})),React.createElement(oe,{title:"Stickers Size",value:t.storage.stickerSize.toString(),onChange:e=>t.storage.stickerSize=parseInt(e)},le.map(e=>React.createElement(ie,{label:e.toString(),subLabel:e==160?"Default":null,key:e.toString(),value:e.toString()}))),React.createElement(ce,{messageType:0},"Stickers size option does not work consistently at the moment.")))}var y,de=()=>{y&&B(),y=[M(),ae()]},B=()=>y?.forEach?.(e=>e?.()),ge=ue;return v.onLoad=de,v.onUnload=B,v.settings=ge,v})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.ui.alerts,vendetta.storage,vendetta.ui.components);
